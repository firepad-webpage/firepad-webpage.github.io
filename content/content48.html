<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excerpt</title>
</head>
<body>
    <h2>Excerpt</h2>
    <p>Thanks to their capability to support customizable functions, programmable network chips are becoming more and more popular with a burgeoning arsenal which enlists NVIDIA Spectrum, AMD Pensando, Intel Tofino and IPU, Cisco Silicon One, Juniper Trio, Broadcom Trident, and many others.</p><p>The architectures of these chips can be categorized into three types: pipeline, multi-core Run-To-Completion (RTC), and the hybrid of the two.</p><p>Albeit with high throughput, a pipeline is awkward or even incapable in handling complex and stateful network tasks which involve long dependency chains, feedback loops, substantial computations, or large flow tables.</p><p>RTC cores, on the other hand, are flexible enough for such tasks, but suffer from performance inefficiencies.</p><p>The hybrid architecture combines a pipeline and a number of RTC processors, trying to close the gaps of performance and capability.</p><p>However, without knowing the application requirements in advance, the mechanical hardware juxtaposition can hardly achieve the optimal resource allocation and performance.</p><p>Another architectural difficulty is the interconnection of the two types of resources.</p><p>Moreover, the programming model requires to program for each type of resources separately with manual function mapping, which is often inefficient and nonoptimal.</p><p>We consider three typical network applications to illustrate the limitations of the current network chips.</p><p>The distributed machine learning, and especially the large language model training, may engage the programmable network devices for in-network parameter aggregation to accelerate the process and reduce the network traffic.</p><p>When a cache miss occurs, the corresponding key-value pair are fetched from the server for cache replacement.</p><p>An ideal solution would use the pipeline for rapid cache lookups and, upon a cache miss, use the RTC core to fetch the replacement value from the server.</p><p>Other essential network functions include server load balancing and NAT.</p><p>There are numerous proposals to integrate certain network functions in programmable data plane devices (e.g., switches and NICs).</p><p>Constrained by its complexity, a single function might occupy most of the resources on a pipeline-based chip, leaving little room for other equally important functions.</p><p>Ideally, the basic and common functions which apply to all the traffic should be handled by a pipeline and the complex functions which apply to only selected packets should be handled by RTC cores.</p><p>With a hardened architecture, this is unrealistic because of the absence of advance knowledge on both applications and traffic distribution.</p><p>Our objective is to design a better hybrid architecture which synergizes the benefits of the pipeline and multi-core RTC architectures, while ensuring efficient resource utilization under dynamic conditions, to achieve a versatile, one-size-fits-all solution.</p><p>Essentially, we aim to create a software-defined transformable data path.</p><p>The new chip architecture, OptimusPrime, enables dual programmability for both hardware roles and functions for each block.</p><p>The pipeline in OptimusPrime is decoupled from the RTC processors and used to handles the common “match-action”-type tasks in only one pass to achieve the best possible performance.</p><p>This gives OptimusPrime an advantage in throughput.</p><p>Such an architecture brings new challenges to network programming languages and compilers.</p><p>Given that our architecture involves both pipeline and RTC cores, we consider the fusion of languages reasonable.</p><p>Specifically, we propose to combine P4 and C while using P4 as the base.</p><p>Users can embed C code in their P4 programs which can be compiled by our compiler and mapped to the target chip.</p><p>Our major contributions are summarized as follows.</p><p>We analyze the similarities and differences between the pipeline and multi-core RTC architectures.</p><p>Through switch configuration, each block can function as either a pipeline stage or a multi-core RTC processor.</p><p>We preserve the P4 programming paradigm and integrate C programming into the framework named P4X.</p><p>To validate our architecture, we conduct software-based ASIC simulations and realize an FPGA-based prototype.</p><p>We implement and analyze three aforementioned use cases on OptimusPrime: machine learning parameter aggregation, in-network caching, and network function integration.</p><p>They all present much superior performance and flexibility.</p><p>The key to achieve this is twofold: in hardware, we explore the opportunities for full hardware resource sharing and multiplexing, and in software, we allow users to program in a unified language.</p><p>Instead, OptimusPrime uses a ring bus to connect the blocks, which is sufficient to meet the communication requirements at low cost.</p><p>We advocate a pipeline-oriented programming style by extending the P4 language and rely on the compiler to finish the program mapping and block transformation.</p><p>We find that the constructs of such a processor share a lot in common with a pipeline stage, making it feasible and efficient to play two roles based on the same hardware.</p><p>When a block is transformed into a pipeline stage, it is basically equivalent to an MAU in Tofino, supporting full P4 pipeline programming.</p><p>When a block is transformed to multiple RTC cores, the structure of each core is similar to the RV32I five-stage pipeline CPU.</p><p>The transformable blocks are interconnected through a ring-based network.</p><p>Each core maintains a FIFO buffer for PHVs in its private memory.</p><p>The inner ring is used for inter-block memory access and payload transmission.</p><p>The capability of transmitting payload on the inner ring allows OptimusPrime to support DPI.</p><p>After the packet completes ingress processing and exits, it passes through the traffic manager module, and reenters the ring for egress processing.</p><p>The architecture shown in Fig. 2 can be multiplexed to support both ingress and egress.</p><p>We leave the compiler design for joint ingress-egress optimization for future work.</p><p>Currently no unified programming language is available for the simple hybrid architecture, let alone the transformable architecture.</p><p>P4X allows a program to include the C programming elements such as the switch and loop statements, the ternary expressions, and their nested combinations.</p><p>The block annotation @CPU{...} can be applied to compile a specific portion of code to the RTC cores.</p><p>The back-end compiler then partitions and allocates the entire program based on certain optimization goals.</p><p>The compiler cannot predict the actual traffic characteristics, it can only provide an optimization under the worst-case traffic conditions.</p><p>The back-end compiler then analyzes the CFG and executes the allocation algorithm.</p><p>We implement a hardware prototype of OptimusPrime with 8,937 lines of Scala code on a Xilinx UltraScale+ XCVU13P-based FPGA board.</p><p>The prototype comprises 4 transformable blocks, each of which can be configured as a pipeline stage or an 8-core RTC processor.</p><p>We also analyze the ASIC prototype using Design Compiler on an open-source 45nm ASIC technology library at a frequency of 1 GHz.</p><p>These results confirm the moderate overhead for supporting transformable blocks.</p><p>We evaluate the OptimusPrime prototype and its programming by implementing three representative use cases.</p><p>On the pipeline, the packets with the same task ID are allocated to the same RTC core to ensure the correctness.</p><p>The performance bottleneck is the port bandwidth rather than the packet processing throughput.</p><p>Our system outperforms P4LRU across all scenarios, achieving a reduction of the queries to the remote server by 40.9% to 44.9%.</p><p>The cache performance is related to the partitioning ratio of the transformable blocks.</p><p>When integrating multiple network functions, the dependency chain of the program topology can be too long to fit in one pipeline.</p><p>Network functions are usually deployed at network gateways.</p><p>Because no packet recirculation is needed, implementations on OptimusPrime always show lower average latency and higher throughput.</p><p>The aforementioned experiments demonstrate that contention on the inner ring may affect the performance of OptimusPrime, but the impact is acceptable in most situations.</p><p>OptimusPrime is a novel programmable network chip architecture which supports coexistence of pipeline and RTC cores with transformable hardware blocks.</p><p>With a little extra cost, OptimusPrime allows switches and smartNICs to expand their programmability potential to a new level.</p><p>OptimusPrime retains high performance while endowing the programmable pipeline with richer packet processing capabilities.</p>
    <h2>Original Abstract</h2> 
    <p>Programmable network chips are increasingly important for executing complex, stateful network tasks, yet current architectures—pipeline, run-to-completion (RTC), and their hybrids—suffer from rigidity, inefficiency, or poor resource utilization under dynamic conditions. To address these limitations, this work introduces OptimusPrime, a novel programmable network chip architecture with transformable hardware blocks capable of functioning as either pipeline stages or multi-core RTC processors. OptimusPrime supports dual programmability for both hardware roles and user-defined functions, enabling efficient execution of diverse applications such as machine learning aggregation, in-network caching, and network function integration. To program this architecture, the authors propose P4X, a unified language framework combining P4 and embedded C, compiled via a custom backend for resource-optimized deployment. The system is validated through FPGA prototyping and ASIC simulation, demonstrating reduced server queries (by up to 44.9%), improved throughput, and lower latency compared to existing solutions. Overall, OptimusPrime significantly enhances flexibility and performance in programmable data planes, pushing the boundary of software-defined networking.</p>
</body>
</html>
